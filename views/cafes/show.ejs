<%- include("../partials/header") %>
<div class="show-main-div">

    <div id='map' style='width: 480px; height: 400px;'></div>

    <div class='show-card'>

        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">

                <% cafe.images.forEach((image, i) => { %>
                <div class="carousel-item <%= i===0 ? "active" : "" %>">
                    <img class="show-image" src="<%= image.url %>" alt="">
                </div>
                <% }) %>

            </div>
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>


        <div class="cafe-text">
            <div class="cafe-text-row-1">
                <div>
                    <h1 class="show-cafe-name"><%= cafe.name %></h1>
                    <h3 class="show-cafe-area"><%= cafe.area %></h3>
                </div>
                <h5 class="show-cafe-author">Cafe Created By: <strong><%= cafe.author.username %></strong></h5>
            </div>

            <!-- hide or show edit/delete buttons if user is this cafe's author... -->
            <!-- currentUser comes from app.js; everything, like the header, has access to it... -->
            <% if (currentUser && cafe.author.id.equals(currentUser._id)) {
        %>
            <div class="buttons-row">
                <a href='/cafes/<%= cafe._id %>/edit'><button class='btn btn-warning btn-sm'>Edit
                        Information</button></a>
                <!-- A form is needed for the DESTROY route... -->
                <!-- The method on a delete is POST, not DELETE because we need to work around the fact that HTML does not support DELETE by adding ?_method=DELTE... -->
                <form method='POST' action='/cafes/<%= cafe._id %>?_method=DELETE'>
                    <button class='btn btn-danger btn-sm'>Delete This Cafe</button>
                </form>
            </div>
            <% } %>
        </div>
    </div>

    <div class="show-comments-div">
        <div class="comments-header">
            <!-- <h3 class='leave-comment-h3'>Comments</h3> -->
            <h3 class='leave-comment-h3'><%= cafe.comments.length %>
                <%= cafe.comments.length === 1 ? 'Comment' : 'Comments' %>
                <% console.log(cafe, cafe.comments.length, cafe.comments); %>
            </h3>
            <a href='/cafes/<%= cafe._id %>/comments/new'><button
                    class="btn-success-yun-small leave-comment-button">Leave a
                    Comment</button></a>
        </div>
        <% cafe.comments.forEach(comment => { %>
        <div class="show-individual-comment-div">
            <div class='comment-text-area'>
                <% if (currentUser && comment.author.id.equals(currentUser._id)) {
            %>
                <div class="comment-if-author-buttons-row">
                    <a href='/cafes/<%= cafe._id %>/comments/<%= comment._id %>/edit'>
                        <!-- <button class='btn btn-warning btn-sm'>Edit This Comment</button> -->
                        <i class="far fa-edit" data-toggle="tooltip" data-html="true" data-placement="top"
                            title="EDIT THIS COMMENT"></i>
                    </a>
                    <form method='POST' action='/cafes/<%= cafe._id %>/comments/<%= comment._id %>?_method=DELETE'>
                        <!-- <button class='btn btn-danger btn-sm'>Delete This Comment</button> -->
                        <button class='trash-button'><i class="far fa-trash-alt" data-toggle="tooltip" data-html="true"
                                data-placement="top" title="DELETE THIS COMMENT"></i>
                        </button>
                    </form>
                </div>
                <% }%>
                <h4 class='comment-text'><%= comment.text %></h4>
            </div>
            <h5 class='comment-author-name'><strong><%= comment.author.username %></strong> on
                <%= comment.created.getFullYear() %> <%= ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October",
        "November", "December"][comment.created.getMonth()] %> <%= comment.created.getDate() %></h5>
            <!-- hide or show edit/delete buttons if user is this cafe' s author... -->
            <!-- currentUser comes from app.js; everything, like the header, has access to it... -->
        </div>
        <% }); %>

    </div>
</div>

<%- include("../partials/footer") %>

<script>
    mapboxgl.accessToken = '<%- process.env.MAPBOX_TOKEN %>';
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11', // stylesheet location
        center: [<%= cafe.geometry.coordinates %>], // starting position [lng, lat]
        zoom: 12// starting zoom
    });

    const marker = new mapboxgl.Marker({ color: "#32c1e9" })
        .setLngLat([<%= cafe.geometry.coordinates %>])
        .addTo(map);

</script>